<div class="pageheader">


    <h2><i class="fa fa-tachometer"></i> 信息发布选项管理
        <span></span>
    </h2>
    <div class="breadcrumbs">
        <ol class="breadcrumb">
            <li>当前位置</li>
            <li class="active">信息发布选项</li>
            <li class="active">信息发布选项管理</li>
        </ol>
    </div>


</div>


<section class="tile color transparent-black">
    <!-- tile header -->
    <div class="tile-header">
        <h1><strong></strong></h1>
        <div class="controls">
            <a href="#" class="refresh"><i class="fa fa-refresh"></i></a>
            <a href="#" class="remove"><i class="fa fa-times"></i></a>
        </div>
    </div>
    <!-- /tile header -->

    <div class="form-horizontal">

        <div class="row">
            <form id="searchForm" >
                <div class="form-group col-md-4">
                    <label for="userTypeSearch" class="col-sm-4 control-label">用户类型</label>
                    <div class="col-sm-8" id="userTypeSearch">
                        <select class="chosen-select chosen-transparent form-control" id="userTypeSearchSelector">
                            <option value="">请选择</option>
                            <option value="1">借款人</option>
                            <option value="2">出借人</option>
                        </select>
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="col-sm-4 control-label" for="menuNameSearch">菜单名称</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="menuNameSearch" name="menuName" placeholder="输入菜单名称">
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="col-sm-4 control-label" for="menuUrlSearch">菜单链接地址</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="menuUrlSearch" name="menuUrl" placeholder="输入菜单链接地址">
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label for="input07" class="col-sm-4 control-label">Normal select box *</label>
                    <div class="col-sm-8" id="selectbox5">
                        <select class="chosen-select chosen-transparent form-control" id="input09"
                                parsley-trigger="change" parsley-required="true" parsley-error-container="#selectbox">
                            <option value="">Please choose</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="col-sm-4 control-label">
                    </label>
                    <div class="col-sm-8">
                        <button type="button" id="searchBtn" class="btn btn-primary">查询</button>
                        <button type="button" id="resetBtn" class="btn btn-danger margin-left-15">重置</button>
                    </div>
                </div>
            </form>
        </div>

    </div>

    <div class="tile-body nopadding">
        <a id="addMenuBtn" role="button" class="btn btn-success margin-15">添加</a>
        <div class="modal fade" id="modalConfirm" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false"
             aria-labelledby="modalConfirmLabel" aria-hidden="true">
            <div class="modal-dialog" style="width: 60%">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"aria-hidden="true">关闭</button>
                        <h3 class="modal-title" id="modalConfirmLabel"><strong>新增发布选项</strong></h3>
                    </div>
                    <div class="modal-body">
                        <form role="form" parsley-validate id="basicvalidations">
                            <input id="id" type="hidden" name="id" />
                            <div class="form-horizontal">
                                <div class="row">
                                    <div class="form-group col-md-4">
                                        <label for="userType" class="col-sm-4 control-label">用户类型*</label>
                                        <div class="col-sm-8" id="userTypeSelector">
                                            <select class="chosen-select chosen-transparent form-control"
                                                    id="userType" name="userType"
                                                    parsley-trigger="change" parsley-required="true"
                                                    parsley-error-container="#userTypeSelector">
                                                <option value="">请选择用户类型</option>
                                                <option value="1">借款人</option>
                                                <option value="2">出借人</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="optionsName" class="col-sm-4 control-label">选项名称*</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="optionsName" name="optionsName"
                                                   parsley-trigger="change" parsley-required="true"
                                                   parsley-validation-minlength="1">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="userType" class="col-sm-4 control-label">控件类型*</label>
                                        <div class="col-sm-8" id="optionsControlTypeSelector">
                                            <select class="chosen-select chosen-transparent form-control"
                                                    id="optionsControlType" name="optionsControlType"
                                                    parsley-trigger="change" parsley-required="true"
                                                    parsley-error-container="#optionsControlTypeSelector">
                                                <option value="">请选择控件类型</option>
                                                <option value="input">输入框</option>
                                                <option value="dropDown">下拉框</option>
                                                <option value="switch">开关</option>
                                                <option value="multipleSelect">多选框</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-4">
                                        <label for="optionsDefaultValue" class="col-sm-4 control-label">默认值</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="optionsDefaultValue" name="optionsDefaultValue"
                                                   parsley-trigger="change" parsley-validation-minlength="1">
                                        </div>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="optionsUnit" class="col-sm-4 control-label">选项值单位</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="optionsUnit" name="optionsUnit"
                                                   parsley-trigger="change" parsley-validation-minlength="1">
                                        </div>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="optionsValueType" class="col-sm-4 control-label">值数据类型</label>
                                        <div class="col-sm-8" id="optionsValueTypeSelector">
                                            <select class="chosen-select chosen-transparent form-control"
                                                    id="optionsValueType" name="optionsValueType"
                                                    parsley-trigger="change"
                                                    parsley-error-container="#optionsValueTypeSelector">
                                                <option value="">请选择数据类型</option>
                                                <option value="String">字符串</option>
                                                <option value="Integer">整数</option>
                                                <option value="Double">小数</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-4">
                                        <label for="optionsLowValue" class="col-sm-4 control-label">值最低值</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="optionsLowValue" name="optionsLowValue"
                                                   parsley-trigger="change" parsley-validation-minlength="1">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="optionsHeightValue" class="col-sm-4 control-label">值最高值</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="optionsHeightValue" name="optionsHeightValue"
                                                   parsley-trigger="change" parsley-validation-minlength="1">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="isDoubleInputCheck" class="col-sm-4 control-label">是否为多输入框</label>
                                        <input type="hidden" id="isDoubleInputHidden" name="isDoubleInput"/>
                                        <div class="col-sm-8">
                                            <div class="onoffswitch labeled cyan" id="optionsHeightValueSwitch">
                                                <input type="checkbox" class="onoffswitch-checkbox" name="isDoubleInputCheck" onchange="onCheckChange(this)" id="isDoubleInputCheck">
                                                <label class="onoffswitch-label" for="isDoubleInputCheck">
                                                    <span class="onoffswitch-inner"></span>
                                                    <span class="onoffswitch-switch"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group form-footer">
                                <div class="custom-labels">
                                    <button type="button" id="submitBtn" class="btn btn-primary">提交</button>
                                </div>
                            </div>

                        </form>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>
        <!--<button type="button" class="btn btn-primary margin-15">Primary</button>-->
        <table id="table" class="table table-bordered table-sortable">
        </table>

    </div>
    <!-- /tile body -->

</section>
<script type="text/javascript">
    function onCheckChange(obj) {
        if($(obj).val()=="on"){
            $("#isDoubleInputHidden").val(true);
        }else{
            $("#isDoubleInputHidden").val(false);
        }
    }

    var userManage = {
        getQueryCondition: function (data) {
            var param = {};//menuNameSearch menuUrlSearch
            param.menuName = $("#menuNameSearch").val();//查询条件
            param.menuUrl = $("#menuUrlSearch").val();//查询条件
            //组装分页参数
            param.startIndex = data.start;
            param.pageSize = data.length;
            param.draw = data.draw;
            return param;
        }
    };
    $(function () {
        /*chosen.jquery.min.js配置*/
        $(".chosen-select").chosen({
            disable_search_threshold: 10,
            disable_search: false,
            allow_single_deselect: true,
            max_selected_options: 1
        });

        /*添加按钮点击事件*/
        $("#addMenuBtn").click(function () {
            $("#id").val("");
            $("#userType").val('').trigger("chosen:updated");
            $("#optionsName").val("");
            $("#optionsControlType").val("").trigger("chosen:updated");
            $("#optionsDefaultValue").val("");
            $("#optionsUnit").val("");
            $("#optionsValueType").val("").trigger("chosen:updated");
            $("#optionsLowValue").val("");
            $("#optionsHeightValue").val("");
            $("#isDoubleInputHidden").val("");
            $("#isDoubleInputCheck").prop("checked",false);
            $("#modalConfirm").modal();
        });
        
        var $table = $("#table").dataTable($.extend(true, {}, CONSTANT.DATA_TABLES.DEFAULT_OPTION, {
            ajax: function (data, callback, settings) {
                //封装请求参数
                var param = userManage.getQueryCondition(data);
                $.ajax({
                    type: PagePublishOptions.type,
                    url: PagePublishOptions.url,
                    cache: false,  //禁用缓存
                    data: param,    //传入已封装的参数
                    dataType: "json",
                    success: function (result) {
                        //异常判断与处理
                        if (!result.success) {
                            PXF.errorDialog(result.message);
                            return;
                        }
                        //封装返回数据
                        var returnData = {};
                        returnData.draw = result.draw;//这里直接自行返回了draw计数器,应该由后台返回
                        returnData.recordsTotal = result.data.totalElements;//总记录数
                        returnData.recordsFiltered = result.data.totalElements;//后台不实现过滤功能，每次查询均视作全部结果
                        returnData.data = result.data.content;
                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        PXF.errorDialog("查询失败");
                    }
                });
            },
            //绑定数据
            columns: [
                {
                    targets:0,
                    title: "用户类型",
                    data: "userType",
                    render:function (data,type, row, meta) {
                        if(data==1){
                            return "借款人";
                        }else if(data==2){
                            return "出借人";
                        }
                    }
                },
                {
                    targets:1,
                    title: "选项名称",
                    data: "optionsName"//字段名
                },
                {
                    targets:2,
                    title: "控件类型",
                    data: "optionsControlType",//字段名
                    render:function (data,type, row, meta) {
                        var returnData=data;
                        switch (data){
                            case "input":
                                returnData="输入框";
                                break;
                            case "dropDown":
                                returnData="下拉框";
                                break;
                            case "switch":
                                returnData="开关";
                                break;
                            case "multipleSelect":
                                returnData="多选框";
                                break;
                        }
                        return returnData;
                    }
                },
                {
                    targets:3,
                    title: "默认值",
                    data: "optionsDefaultValue"
                },
                {
                    targets:4,
                    title: "值单位",
                    data: "optionsUnit"
                },
                {
                    targets:5,
                    title: "值数据类型",
                    data: "optionsValueType",
                    render:function (data,type, row, meta) {
                        //
                        var returnData=data;
                        switch (data){
                            case "String":
                                returnData="字符串";
                                break;
                            case "Integer":
                                returnData="整数";
                                break;
                            case "Double":
                                returnData="小数";
                                break;
                        }
                        return returnData;
                    }
                },
                {
                    targets:6,
                    title: "值最低值",
                    data: "optionsLowValue"
                },
                {
                    targets:7,
                    title: "值最高值",
                    data: "optionsHeightValue"
                },
                {
                    targets:8,
                    title: "双输入框",
                    data: "isDoubleInput",
                    render:function (data,type, row, meta) {
                        if(data==null||data==''||data==false){
                            return "否";
                        }else if(data==true){
                            return "是";
                        }else{
                            return data;
                        }
                    }
                },
                {
                    targets:9,
                    title: "操作",
                    data:"",
                    orderable: false,
                    render : function(data,type, row, meta) {
                        return "<a class='edit' style='cursor: pointer'>编辑</a><a class='delete' style='cursor: pointer'>删除</a>";
                    }
                }
            ],
            createdRow: function ( row, data, index ) {
                $('td', row).each(function (e) {
                    $(this).attr("class","text-center");
                });
                $('td', row).eq(9).attr("class","actions text-center");
            },
            drawCallback: function (settings) {
                //渲染完毕后的回调
                //默认选中第一行
                // $("tbody tr",$table).eq(0).click();
            }
        })).api();//此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
        $(document).on("click", "#table a.edit", function (e) {
            var nRow = $(this).parents('tr')[0];
            editRow($table, nRow);
        });

        $(document).on("click", "#table a.delete", function (e) {
            var nRow = $(this).parents('tr')[0];
            deleteRow($table, nRow);
        });

        //删除
        function deleteRow(table, nRow) {
            PXF.confirmDialog("确认删除？",function () {
                PXF.ajax(deletePublishOptions,{id:table.row( nRow ).data().id},function () {
                    $table.ajax.reload();
                },function () {})
            })
        }
        //编辑
        function editRow(table, nRow) {
            /*$('#waterfall-is-rules').selectpicker('val', response.data.cash.entry_type);*/
            /*userType optionsName optionsControlType optionsDefaultValue optionsUnit optionsValueType optionsLowValue optionsHeightValue isDoubleInputHidden isDoubleInputCheck*/
            var aData=table.row( nRow ).data();
            $("#modalConfirm").modal();
            $("#userType").val(aData.userType).trigger("chosen:updated");
            $("#id").val(aData.id);
            $("#optionsName").val(aData.optionsName);
            $("#optionsControlType").val(aData.optionsControlType).trigger("chosen:updated");
            $("#optionsDefaultValue").val(aData.optionsDefaultValue);
            $("#optionsUnit").val(aData.optionsUnit);
            $("#optionsValueType").val(aData.optionsValueType).trigger("chosen:updated");
            $("#optionsLowValue").val(aData.optionsLowValue);
            $("#optionsHeightValue").val(aData.optionsHeightValue);
            $("#isDoubleInputHidden").val(aData.isDoubleInput);
            $("#isDoubleInputCheck").prop("checked",aData.isDoubleInput);
            // $("#menuName").val(aData.menuName);
            // $("#menuUrl").val(aData.menuUrl);
            // $("#menuPid").val(aData.menuPid);
        }

        $("#searchBtn").click(function () {
            $table.ajax.reload();
        });

        $("#submitBtn").click(function () {
            var isValidate=$("#basicvalidations").parsley().validate();
            if(isValidate){
                PXF.ajax(saveOrUpdatePublishOptions,$("#basicvalidations"),function (data) {
                    $table.ajax.reload();//表格重载
                    $("#modalConfirm").modal('hide');
                    $("#menuName").val("");
                    $("#menuUrl").val("");
                    $("#menuPid").val("");
                },function () {})
            }
        });
    });
</script>

      
